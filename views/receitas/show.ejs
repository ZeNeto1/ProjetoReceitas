<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title><%= receita.titulo %></title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <div class="container">
        <div class="page-header">
            <h1><%= receita.titulo %></h1>
            <a href="/receitas" class="btn btn-voltar">Voltar ao Catálogo</a>
        </div>
        
        <p><strong>Autor:</strong> <%= receita.Usuario ? receita.Usuario.nome : 'Desconhecido' %></p>
        <p><strong>Tempo de Preparo:</strong> <%= receita.tempoPreparo %> minutos</p>
        
        <h3>Descrição:</h3>
        <p class="receita-descricao"><%= receita.descricao %></p>
        <hr>

        <a class="btn btn-cadastrar" href="/avaliacoes/create?receitaId=<%= receita.id %>">Avaliar esta Receita</a>
        
        <h3>Avaliações:</h3>
        <% if (media !== null) { %>
            <p><strong>Média:</strong> <%= media.toFixed(1) %>/5 ⭐</p>
        <% } %>
        <% if (receita.Avaliacaos && receita.Avaliacaos.length > 0) { %>
            <div class="avaliacoes-list">
                <% receita.Avaliacaos.forEach(Avaliacaos => { %>
                    <div class="Avaliacaos-card" style="border: 1px solid #ddd; padding: 10px; margin: 10px 0; border-radius: 5px;">
                        <p><strong><%= Avaliacaos.Usuario ? Avaliacaos.Usuario.nome : 'Anônimo' %></strong></p>
                        <p><strong>Nota:</strong> <%= Avaliacaos.nota %>/5 ⭐</p>
                        
                        <p><strong>Comentário:</strong> <%= Avaliacaos.comentario || 'Sem comentário' %></p>
                        <small><em>Avaliado em: <%= new Date(Avaliacaos.createdAt).toLocaleDateString('pt-BR') %></em></small>
                    
                        <a class="btn btn-editar btn-sm" href="/avaliacoes/<%= Avaliacaos.id %>/editar">Editar Avaliação</a>
                    
                        <form action="/avaliacoes/<%= Avaliacaos.id %>?_method=DELETE" method="POST"
                              onsubmit="return confirm('Confirma exclusão desta avaliação?');"
                              style="display:inline; margin-left:10px;">
                            <button type="submit" class="btn btn-deletar btn-sm">Excluir</button>
                        </form>
                    </div>
                <% }) %>
            </div>
        <% } else { %>
            <p>Nenhuma avaliação ainda. Seja o primeiro a avaliar!</p>
        <% } %>
    </div>
</body>
</html>